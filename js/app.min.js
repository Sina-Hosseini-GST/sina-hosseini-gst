import*as THREE from"three";import{OrbitControls}from"three/examples/jsm/controls/OrbitControls.js";import gsap from"gsap";import{DoubleSide,Group}from"three";const body=document.body,lockedClass="locked",canvas=document.querySelector("canvas");let part,section;part=window.innerWidth>=1024?Math.round(document.documentElement.scrollLeft/window.innerWidth):Math.round(document.documentElement.scrollTop/window.innerHeight);const sectionContainer=document.querySelector("#section-container"),sections=document.querySelectorAll("section"),button_1_2=document.getElementById("1-2-button"),button_2_1=document.getElementById("2-1-button"),button_2_3=document.getElementById("2-3-button"),button_3_2=document.getElementById("3-2-button"),xButtonArray=[button_1_2,button_2_1,button_2_3,button_3_2],upButton=document.querySelector("#up-button"),downButton=document.querySelector("#down-button"),yButtonArray=[upButton,downButton],header=document.querySelector("header"),footer=document.querySelector("footer"),main=document.querySelector("main");let rotationState=!0;const scene=new THREE.Scene,textureLoader=new THREE.TextureLoader,textureArrayOne=[textureLoader.load("/assets/img/webdev/svelte.png"),textureLoader.load("/assets/img/webdev/css.png"),textureLoader.load("/assets/img/webdev/html.png"),textureLoader.load("/assets/img/webdev/javascript.png"),textureLoader.load("/assets/img/webdev/three-js.png"),textureLoader.load("/assets/img/webdev/tailwind-css.png")],textureArrayTwo=[textureLoader.load("/assets/img/gaming/bootleg-games-wiki.png"),textureLoader.load("/assets/img/gaming/bootleg-games-wiki.png"),textureLoader.load("/assets/img/gaming/forever-classic-games.png"),textureLoader.load("/assets/img/gaming/forever-classic-games.png"),textureLoader.load("/assets/img/gaming/mega-cat.png"),textureLoader.load("/assets/img/gaming/mega-cat.png")],textureArrayThree=[textureLoader.load("/assets/img/translation/metal-gear.png"),textureLoader.load("/assets/img/translation/metal-gear.png"),textureLoader.load("/assets/img/translation/resident-evil.png"),textureLoader.load("/assets/img/translation/resident-evil.png"),textureLoader.load("/assets/img/translation/ninja-gaiden.png"),textureLoader.load("/assets/img/translation/ninja-gaiden.png")],textureArray=[textureArrayOne,textureArrayTwo,textureArrayThree],createCubeFromPlanes=(boxSegment,planeSize)=>{const cube=new THREE.Group,boxSize=boxSegment*planeSize,planePositionArray=[];if(boxSegment%2==1){let value=0;planePositionArray.push(value);for(let i=0;i<Math.floor(boxSegment/2);i++)value+=planeSize,planePositionArray.reverse(),planePositionArray.push(value),planePositionArray.reverse(),planePositionArray.push(-value);planePositionArray.reverse()}else{let value=planeSize/2;planePositionArray.push(value),planePositionArray.push(-value);for(let i=0;i<boxSegment/2-1;i++)value+=planeSize,planePositionArray.reverse(),planePositionArray.push(value),planePositionArray.reverse(),planePositionArray.push(-value);planePositionArray.reverse()}for(let i=0;i<6;i++){const planeGroup=new THREE.Group;for(let j=0;j<boxSegment;j++)for(let k=0;k<boxSegment;k++){const planeGeometry=new THREE.PlaneGeometry(planeSize,planeSize),planeMaterial=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,opacity:1}),plane=new THREE.Mesh(planeGeometry,planeMaterial);plane.position.x=planePositionArray[j],plane.position.y=planePositionArray[k],planeGroup.add(plane)}switch(planeGroup.userData.id=i,i){case 0:planeGroup.position.y=boxSize/2,planeGroup.rotation.x=-Math.PI/2;break;case 1:planeGroup.position.y=-boxSize/2,planeGroup.rotation.x=Math.PI/2;break;case 2:planeGroup.position.z=boxSize/2;break;case 3:planeGroup.position.z=-boxSize/2,planeGroup.rotation.y=Math.PI;break;case 4:planeGroup.position.x=-boxSize/2,planeGroup.rotation.y=-Math.PI/2;break;case 5:planeGroup.position.x=boxSize/2,planeGroup.rotation.y=Math.PI/2}cube.add(planeGroup)}return cube},addTextureToCube=(textureArray,cube)=>{for(let i=0;i<6;i++){const planeGroup=cube.children[i],boxSegment=Math.sqrt(planeGroup.children.length),textureOffsetArray=[];let textureOffsetX=-1/boxSegment;for(let j=0;j<boxSegment;j++){textureOffsetX+=1/boxSegment;let textureOffsetY=-1/boxSegment;for(let k=0;k<boxSegment;k++)textureOffsetY+=1/boxSegment,textureOffsetArray.push([textureOffsetX,textureOffsetY])}if(i==planeGroup.userData.id)for(let j=0;j<planeGroup.children.length;j++){const plane=planeGroup.children[j];plane.material.map=textureArray[i].clone(),plane.material.map.needsUpdate=!0,plane.material.map.offset.x=textureOffsetArray[j][0],plane.material.map.offset.y=textureOffsetArray[j][1],plane.material.map.repeat.x=1/boxSegment,plane.material.map.repeat.y=1/boxSegment}}},getPlanePositionOfCube=cube=>{const planePositionArray=[];for(let i=0;i<cube.children.length;i++){const planeGroup=cube.children[i];for(let j=0;j<planeGroup.children.length;j++){const plane=planeGroup.children[j];planePositionArray.push({x:plane.position.x,y:plane.position.y,z:plane.position.z})}}return planePositionArray},deformCube=(cube,duration)=>{for(let i=0;i<cube.children.length;i++){const planeGroup=cube.children[i];for(let j=0;j<planeGroup.children.length;j++){const plane=planeGroup.children[j],xPlanePosition=50*Math.random(),yPlanePosition=50*Math.random(),zPlanePosition=50*Math.random();gsap.to(plane.position,{duration:duration,ease:"power4.in",x:xPlanePosition,y:yPlanePosition,z:zPlanePosition});const xPlaneRotation=5*Math.random(),yPlaneRotation=5*Math.random(),zPlaneRotation=5*Math.random();gsap.to(plane.rotation,{duration:duration,ease:"power4.in",x:xPlaneRotation,y:yPlaneRotation,z:zPlaneRotation}),gsap.to(plane.material,{duration:duration,ease:"power4.in",opacity:0})}}},reformCube=(cube,duration,planePositionArray)=>{for(let i=0;i<cube.children.length;i++){const planeGroup=cube.children[i];for(let j=0;j<planeGroup.children.length;j++){const plane=planeGroup.children[j];gsap.to(plane.position,{duration:duration,ease:"power4.out",x:planePositionArray[j].x,y:planePositionArray[j].y,z:planePositionArray[j].z}),gsap.to(plane.rotation,{duration:duration,ease:"power4.out",x:0,y:0,z:0}),gsap.to(plane.material,{duration:duration,ease:"power4.out",opacity:1})}}},transformCube=(cube,duration,section)=>{deformCube(cube,duration),rotationState=!1,setTimeout(()=>{addTextureToCube(textureArray[section],cube),reformCube(cube,duration,planePositionArray),rotationState=!0},1e3*duration)},transformCanvas=section=>{1==section?(canvas.classList.remove("md:-translate-x-1/3"),canvas.classList.add("md:translate-x-0")):(canvas.classList.remove("md:translate-x-0"),canvas.classList.add("md:-translate-x-1/3"))},fadeOutAllSections=()=>{for(let i=0;i<sectionContainer.childElementCount;i++){const section=sections[i];section.classList.remove("opacity-100"),section.classList.add("opacity-0")}},fadeOut=element=>{element.classList.remove("opacity-100"),element.classList.add("opacity-0")},fadeIn=element=>{element.classList.remove("opacity-0"),element.classList.add("opacity-100")},fadeInSection=index=>{const section=sections[index];section.classList.remove("opacity-0"),section.classList.add("opacity-100")},showAllYButtons=()=>{upButton.classList.remove("-top-16"),upButton.classList.add("top-0"),downButton.classList.remove("-bottom-16"),downButton.classList.add("bottom-0")},hideUpButton=()=>{upButton.classList.remove("top-0"),upButton.classList.add("-top-16")},hideDownButton=()=>{downButton.classList.remove("bottom-0"),downButton.classList.add("-bottom-16")},convertHeadingIntoPieces=heading=>{const headingContent=heading.textContent.trim();let headingAltContent="";for(let j=0;j<headingContent.length;j++)headingAltContent+=`<span class="inline-flex transition-transform duration-1000 ease-in-out">${headingContent[j]}</span>`;heading.innerHTML=headingAltContent},animateHeading=section=>{const headingArray=document.querySelectorAll("h3");for(let i=0;i<headingArray.length;i++){const heading=headingArray[i];for(let j=0;j<heading.childElementCount;j++){const span=heading.children[j];span.style.transform="rotateX(180deg)"}}const heading=document.querySelector(`section:nth-child(${section+1}) > article > h3`);for(let i=0;i<heading.childElementCount;i++){const span=heading.children[i];setTimeout(()=>{span.style.transform="rotateX(360deg)"},50*i)}},updateScreenSizedElementsHeight=()=>{const hScreenArray=document.querySelectorAll(".h-screen");for(let i=0;i<hScreenArray.length;i++){const hScreen=hScreenArray[i];hScreen.style.height=`${window.innerHeight}px`}},configureLockedClass=()=>{body.classList.add("locked"),setTimeout(()=>{body.classList.remove("locked")},1e3)};updateScreenSizedElementsHeight();const headingArray=document.querySelectorAll("h3");for(let i=0;i<headingArray.length;i++){const heading=headingArray[i];convertHeadingIntoPieces(heading)}for(let i=0;i<xButtonArray.length;i++){const xButton=xButtonArray[i];xButton.addEventListener("click",()=>{xButton==button_1_2?(part+=1,sectionContainer.scrollIntoView({behavior:"smooth"}),animateHeading(section)):xButton==button_2_1?(part-=1,header.scrollIntoView({behavior:"smooth"})):xButton==button_2_3?(part+=1,footer.scrollIntoView({behavior:"smooth"})):xButton==button_3_2&&(part-=1,sectionContainer.scrollIntoView({behavior:"smooth"}),animateHeading(section))})}showAllYButtons(),0==part?hideUpButton():2==part&&hideDownButton();for(let i=0;i<yButtonArray.length;i++){const yButton=yButtonArray[i];yButton.addEventListener("click",()=>{body.classList.contains("locked")||(showAllYButtons(),yButton==upButton?2==part?(part-=1,sectionContainer.scrollIntoView({behavior:"smooth"}),animateHeading(section)):1==part&&0!=section?(section-=1,transformCube(cube,.5,section),fadeOutAllSections(),fadeInSection(section),animateHeading(section),sections[section].scrollIntoView({behavior:"smooth"})):1==part&&0==section&&(part-=1,header.scrollIntoView({behavior:"smooth"}),hideUpButton()):yButton==downButton&&(0==part?(part+=1,sectionContainer.scrollIntoView({behavior:"smooth"}),animateHeading(section)):1==part&&2!=section?(section+=1,transformCube(cube,.5,section),fadeOutAllSections(),fadeInSection(section),animateHeading(section),sections[section].scrollIntoView({behavior:"smooth"})):1==part&&2==section&&(part+=1,footer.scrollIntoView({behavior:"smooth"}),hideDownButton())),transformCanvas(section),configureLockedClass())})}let touchstartValue,touchendValue,touchTarget;window.addEventListener("touchstart",e=>{touchstartValue=e.changedTouches[0].clientY,touchTarget=e.target}),window.addEventListener("touchend",e=>{body.classList.contains("locked")||(touchendValue=e.changedTouches[0].clientY,touchendValue>touchstartValue?(showAllYButtons(),2==part?(part-=1,fadeOut(footer),fadeOut(main),fadeOut(sectionContainer),fadeOutAllSections(),setTimeout(()=>{window.scrollBy(0,-window.innerHeight),fadeIn(footer),fadeIn(main),setTimeout(()=>{fadeIn(sectionContainer),fadeInSection(section),animateHeading(section)},500)},500)):1==part&&0!=section?(section-=1,fadeOut(sectionContainer),fadeOutAllSections(),deformCube(cube,.5),setTimeout(()=>{sectionContainer.scrollBy(0,-window.innerHeight),addTextureToCube(textureArray[section],cube),reformCube(cube,.5,planePositionArray),setTimeout(()=>{fadeIn(sectionContainer),fadeInSection(section),animateHeading(section)},500)},500)):1==part&&0==section?(part-=1,fadeOut(main),fadeOut(sectionContainer),fadeOut(header),setTimeout(()=>{window.scrollBy(0,-window.innerHeight),fadeIn(main),fadeIn(sectionContainer),setTimeout(()=>{fadeIn(header)},500)},500),hideUpButton()):0==part&&hideUpButton(),transformCanvas(section)):touchstartValue>touchendValue?(showAllYButtons(),0==part?(part+=1,fadeOut(header),fadeOut(main),fadeOut(sectionContainer),fadeOutAllSections(),setTimeout(()=>{window.scrollBy(0,window.innerHeight),fadeIn(header),fadeIn(main),setTimeout(()=>{fadeIn(sectionContainer),fadeInSection(section),animateHeading(section)},500)},500)):1==part&&2!=section?(section+=1,fadeOut(sectionContainer),fadeOutAllSections(),deformCube(cube,.5),setTimeout(()=>{sectionContainer.scrollBy(0,window.innerHeight),addTextureToCube(textureArray[section],cube),reformCube(cube,.5,planePositionArray),setTimeout(()=>{fadeIn(sectionContainer),fadeInSection(section),animateHeading(section)},500)},500)):1==part&&2==section?(part+=1,fadeOut(main),fadeOut(sectionContainer),fadeOut(footer),setTimeout(()=>{window.scrollBy(0,window.innerHeight),fadeIn(main),fadeIn(sectionContainer),setTimeout(()=>{fadeIn(footer)},500)},500),hideDownButton()):2==part&&hideDownButton(),transformCanvas(section)):touchstartValue==touchendValue&&(showAllYButtons(),touchTarget==upButton?2==part?(part-=1,sectionContainer.scrollIntoView({behavior:"smooth"}),animateHeading(section)):1==part&&0!=section?(section-=1,transformCube(cube,.5,section),fadeOutAllSections(),fadeInSection(section),animateHeading(section),sections[section].scrollIntoView({behavior:"smooth"})):1==part&&0==section&&(part-=1,header.scrollIntoView({behavior:"smooth"}),hideUpButton()):touchTarget==downButton&&(0==part?(part+=1,sectionContainer.scrollIntoView({behavior:"smooth"}),animateHeading(section)):1==part&&2!=section?(section+=1,transformCube(cube,.5,section),fadeOutAllSections(),fadeInSection(section),animateHeading(section),sections[section].scrollIntoView({behavior:"smooth"})):1==part&&2==section&&(part+=1,footer.scrollIntoView({behavior:"smooth"}),hideDownButton())),transformCanvas(section)),configureLockedClass())});const codeBlock=document.querySelector("#code-block"),maxBlockLength=7;for(let i=0;i<7;i++){let codeSubBlock="<div>";for(let j=0;j<Math.ceil(7*(Math.random()+.25));j++)Math.random()<.5?codeSubBlock+='<span class="code">0</span>':codeSubBlock+='<span class="code font-bold">1</span>';codeSubBlock+="</div>",codeBlock.innerHTML+=codeSubBlock}const codeArray=document.querySelectorAll(".code");for(let i=0;i<codeArray.length;i++){const code=codeArray[i],duration=2e3*(Math.random()+.5);setInterval(()=>{"1"==code.textContent?code.textContent="0":code.textContent="1"},duration)}const cube=createCubeFromPlanes(4,.45);scene.add(cube);const planePositionArray=getPlanePositionOfCube(cube);section=Math.round(sectionContainer.scrollTop/window.innerHeight),addTextureToCube(textureArray[section],cube),fadeOutAllSections(),fadeInSection(section),animateHeading(section),transformCanvas(section),window.addEventListener("wheel",e=>{if(!body.classList.contains("locked")){const scrollY=e.deltaY;showAllYButtons(),scrollY>0?0==part?(part+=1,sectionContainer.scrollIntoView({behavior:"smooth"}),animateHeading(section)):1==part&&2!=section?(section+=1,transformCube(cube,.5,section),fadeOutAllSections(),fadeInSection(section),animateHeading(section),sections[section].scrollIntoView({behavior:"smooth"})):1==part&&2==section?(part+=1,footer.scrollIntoView({behavior:"smooth"}),hideDownButton()):2==part&&hideDownButton():scrollY<0&&(2==part?(part-=1,sectionContainer.scrollIntoView({behavior:"smooth"}),animateHeading(section)):1==part&&0!=section?(section-=1,transformCube(cube,.5,section),fadeOutAllSections(),fadeInSection(section),animateHeading(section),sections[section].scrollIntoView({behavior:"smooth"})):1==part&&0==section?(part-=1,header.scrollIntoView({behavior:"smooth"}),hideUpButton()):0==part&&hideUpButton()),transformCanvas(section),configureLockedClass()}}),window.addEventListener("keyup",e=>{if(!body.classList.contains("locked")){const key=e.key;"ArrowDown"==key||"PageDown"==key?(showAllYButtons(),0==part?(part+=1,sectionContainer.scrollIntoView({behavior:"smooth"}),animateHeading(section)):1==part&&2!=section?(section+=1,transformCube(cube,.5,section),fadeOutAllSections(),fadeInSection(section),animateHeading(section),sections[section].scrollIntoView({behavior:"smooth"})):1==part&&2==section?(part+=1,footer.scrollIntoView({behavior:"smooth"}),hideDownButton()):2==part&&hideDownButton()):"ArrowUp"!=key&&"PageUp"!=key||(showAllYButtons(),2==part?(part-=1,sectionContainer.scrollIntoView({behavior:"smooth"}),animateHeading(section)):1==part&&0!=section?(section-=1,transformCube(cube,.5,section),fadeOutAllSections(),fadeInSection(section),animateHeading(section),sections[section].scrollIntoView({behavior:"smooth"})):1==part&&0==section?(part-=1,header.scrollIntoView({behavior:"smooth"}),hideUpButton()):0==part&&hideUpButton()),transformCanvas(section),configureLockedClass()}}),window.addEventListener("resize",()=>{sizes.width=1.5*window.innerWidth,sizes.height=window.innerHeight,updateScreenSizedElementsHeight(),sectionContainer.scrollTop=section*window.innerHeight,window.innerWidth>=1024?document.documentElement.scrollLeft=part*window.innerWidth:document.documentElement.scrollTop=part*window.innerHeight,camera.aspect=sizes.width/sizes.height,camera.updateProjectionMatrix(),renderer.setSize(sizes.width,sizes.height),renderer.setPixelRatio(Math.min(window.devicePixelRatio,2))});const sizes={width:1.5*window.innerWidth,height:window.innerHeight},camera=new THREE.PerspectiveCamera(75,sizes.width/sizes.height,.1,100);camera.position.z=4,scene.add(camera);const controls=new OrbitControls(camera,canvas);controls.enableDamping=!0;const renderer=new THREE.WebGLRenderer({canvas:canvas});renderer.setSize(sizes.width,sizes.height),renderer.setClearColor(986895);const clock=new THREE.Clock,tick=()=>{const elapsedTime=clock.getElapsedTime();if(rotationState){const xCubeRotation=.125*elapsedTime,yCubeRotation=.25*elapsedTime,zCubeRotation=elapsedTime;cube.rotation.x=xCubeRotation,cube.rotation.y=yCubeRotation,cube.rotation.z=zCubeRotation}controls.update(),renderer.render(scene,camera),window.requestAnimationFrame(tick)};tick();